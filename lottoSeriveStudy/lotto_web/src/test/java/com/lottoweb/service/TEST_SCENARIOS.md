# SavedLottoNumberService 테스트 시나리오

## 개요
`SavedLottoNumberService`의 주요 기능을 검증하는 5가지 테스트 시나리오입니다.

---

## 시나리오 1: 정상적인 로또 번호 저장 테스트

### 목적
유효한 입력값으로 로또 번호를 저장할 때 정상적으로 동작하는지 확인

### 테스트 케이스
1. **정상 저장 성공**
   - 유효한 사용자명, 6개의 유효한 번호, 유효한 보너스 번호 입력
   - 저장 성공 및 번호가 정렬되어 저장되는지 확인

2. **정렬되지 않은 번호도 정렬되어 저장**
   - 입력: `[42, 7, 31, 12, 38, 23]`
   - 예상: `[7, 12, 23, 31, 38, 42]`로 정렬되어 저장

### 검증 항목
- ? 저장된 객체가 null이 아님
- ? 번호가 오름차순으로 정렬되어 저장됨
- ? 보너스 번호가 정상 저장됨
- ? Repository의 save 메서드가 호출됨

---

## 시나리오 2: 유효성 검사 실패 테스트

### 목적
잘못된 입력값에 대해 적절한 예외가 발생하는지 확인

### 테스트 케이스
1. **존재하지 않는 사용자**
   - 예외: `IllegalArgumentException("사용자를 찾을 수 없습니다: ...")`

2. **번호 개수 오류**
   - 6개가 아닌 경우 (null, 5개, 7개 등)
   - 예외: `IllegalArgumentException("로또 번호는 6개여야 합니다.")`

3. **번호 범위 오류**
   - 1 미만 또는 45 초과
   - 예외: `IllegalArgumentException("로또 번호는 1부터 45 사이의 숫자여야 합니다.")`

4. **일반 번호 중복**
   - 같은 번호가 2개 이상 포함
   - 예외: `IllegalArgumentException("로또 번호에 중복이 있습니다.")`

5. **보너스 번호 중복**
   - 보너스 번호가 일반 번호와 동일
   - 예외: `IllegalArgumentException("보너스 번호는 일반 번호와 중복될 수 없습니다.")`

6. **보너스 번호 범위 오류**
   - 1 미만 또는 45 초과
   - 예외: `IllegalArgumentException("보너스 번호는 1부터 45 사이의 숫자여야 합니다.")`

### 검증 항목
- ? 각 케이스마다 적절한 예외 메시지 발생
- ? Repository의 save 메서드가 호출되지 않음

---

## 시나리오 3: 저장된 로또 번호 조회 테스트

### 목적
사용자가 저장한 로또 번호 목록을 정상적으로 조회하는지 확인

### 테스트 케이스
1. **정상 조회 성공**
   - 여러 개의 저장된 번호가 최신순으로 반환되는지 확인

2. **저장된 번호가 없는 경우**
   - 빈 리스트 반환

3. **존재하지 않는 사용자**
   - 예외: `IllegalArgumentException("사용자를 찾을 수 없습니다: ...")`

### 검증 항목
- ? 최신순으로 정렬되어 반환됨
- ? 저장된 번호가 없으면 빈 리스트 반환
- ? Repository의 `findByUserOrderByCreatedAtDesc` 메서드 호출 확인

---

## 시나리오 4: 로또 번호 삭제 테스트

### 목적
저장된 로또 번호를 정상적으로 삭제하는지 확인

### 테스트 케이스
1. **정상 삭제 성공**
   - 사용자가 소유한 번호 삭제 시 `true` 반환
   - Repository의 delete 메서드 호출 확인

2. **존재하지 않는 번호 삭제**
   - `false` 반환
   - delete 메서드 호출되지 않음

3. **다른 사용자의 번호 삭제 시도**
   - `false` 반환 (권한 없음)

4. **존재하지 않는 사용자**
   - 예외: `IllegalArgumentException("사용자를 찾을 수 없습니다: ...")`

### 검증 항목
- ? 삭제 성공 시 `true` 반환
- ? 삭제 실패 시 `false` 반환
- ? 다른 사용자의 번호는 삭제 불가
- ? Repository의 `findByIdAndUser` 및 `delete` 메서드 호출 확인

---

## 시나리오 5: 중복 확인 테스트

### 목적
동일한 번호 조합이 이미 저장되어 있는지 확인하는 기능 검증

### 테스트 케이스
1. **중복된 번호 조합 확인**
   - 이미 저장된 번호와 동일한 조합 → `true` 반환

2. **중복되지 않은 번호 조합**
   - 다른 번호 조합 → `false` 반환

3. **순서가 다른 동일 번호 조합**
   - `[7, 12, 23, 31, 38, 42]`와 `[42, 7, 31, 12, 38, 23]`는 같은 것으로 인식
   - → `true` 반환

4. **저장된 번호가 없는 경우**
   - → `false` 반환

5. **잘못된 입력 (null, 6개 아님)**
   - → `false` 반환

6. **존재하지 않는 사용자**
   - 예외: `IllegalArgumentException("사용자를 찾을 수 없습니다: ...")`

### 검증 항목
- ? 동일한 번호 조합은 순서와 무관하게 중복으로 인식
- ? 다른 번호 조합은 중복이 아님
- ? 잘못된 입력은 `false` 반환 (예외 발생하지 않음)

---

## 테스트 실행 방법

### Maven으로 실행
```bash
mvn test
```

### 특정 테스트 클래스만 실행
```bash
mvn test -Dtest=SavedLottoNumberServiceTest
```

### 특정 테스트 메서드만 실행
```bash
mvn test -Dtest=SavedLottoNumberServiceTest#testSaveLottoNumber_Success
```

---

## 테스트 커버리지

이 테스트 시나리오는 다음 기능을 검증합니다:
- ? `saveLottoNumber()` - 저장 기능 및 모든 유효성 검사
- ? `getSavedLottoNumbers()` - 조회 기능
- ? `deleteSavedLottoNumber()` - 삭제 기능
- ? `isDuplicate()` - 중복 확인 기능
- ? `getSavedLottoNumberCount()` - 개수 조회 기능

---

## 사용된 기술

- **JUnit 5**: 테스트 프레임워크
- **Mockito**: Mock 객체 생성 및 검증
- **@ExtendWith(MockitoExtension.class)**: Mockito 통합
- **@Mock**: Mock 객체 주입
- **@InjectMocks**: 테스트 대상 객체에 Mock 주입
- **@DisplayName**: 테스트 이름 한글 표시

